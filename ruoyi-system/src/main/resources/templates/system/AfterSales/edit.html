<!DOCTYPE html>
<html lang="zh" xmlns:th="http://www.thymeleaf.org">
<head>
    <th:block th:include="include :: header('编辑派工单')"/>
    <th:block th:include="include :: datetimepicker-css"/>
</head>
<body class="white-bg">
<div class="wrapper wrapper-content animated fadeInRight ibox-content">
    <form class="form-horizontal m" id="form-AfterSales-edit" th:object="${afterSales}" method="post" enctype="multipart/form-data">
        <input name="id" th:field="*{id}" type="hidden">
        <div class="col-xs-6">
            <div class="form-group">
                <label class="col-sm-4 control-label">下单日期：</label>
                <div class="col-sm-8">
                    <input name="formDate" th:field="*{formDate}" class="form-control" type="text">
                </div>
            </div>
        </div>
        <div class="col-xs-6">
            <div class="form-group">
                <label class="col-sm-4 control-label">业务员：</label>
                <div class="col-sm-8">
                    <input name="salesman" th:field="*{salesman}" class="form-control" type="text">
                </div>
            </div>
        </div>
        <div class="col-xs-6">
            <div class="form-group">
                <label class="col-sm-4 control-label">客户名称：</label>
                <div class="col-sm-8">
                    <input name="customer" th:field="*{customer}" class="form-control" type="text">
                </div>
            </div>
        </div>
        <div class="col-xs-6">
            <div class="form-group">
                <label class="col-sm-4 control-label">客户地址：</label>
                <div class="col-sm-8">
                    <input name="customerAddr" th:field="*{customerAddr}" class="form-control" type="text">
                </div>
            </div>
        </div>
        <div class="col-xs-6">
            <div class="form-group">
                <label class="col-sm-4 control-label">质保内外0内1外：</label>
                <div class="col-sm-8">
                    <input name="quality" th:field="*{quality}" class="form-control" type="text">
                </div>
            </div>
        </div>
        <div class="col-xs-6">
            <div class="form-group">
                <label class="col-sm-4 control-label">客户联系人：</label>
                <div class="col-sm-8">
                    <input name="connection" th:field="*{connection}" class="form-control" type="text">
                </div>
            </div>
        </div>
        <div class="col-xs-6">
            <div class="form-group">
                <label class="col-sm-4 control-label">客户联系电话：</label>
                <div class="col-sm-8">
                    <input name="tel" th:field="*{tel}" class="form-control" type="text">
                </div>
            </div>
        </div>
        <div class="col-xs-6">
            <div class="form-group">
                <label class="col-sm-4 control-label">问题描述：</label>
                <div class="col-sm-8">
                    <input name="quetion" th:field="*{quetion}" class="form-control" type="text">
                </div>
            </div>
        </div>
        <div class="col-xs-6">
            <div class="form-group">
                <label class="col-sm-4 control-label">出厂日期：</label>
                <div class="col-sm-8">
                    <input name="productionDate" th:field="*{productionDate}" class="form-control" type="text">
                </div>
            </div>
        </div>
        <div class="col-xs-6">
            <div class="form-group">
                <label class="col-sm-4 control-label">出厂编号：</label>
                <div class="col-sm-8">
                    <input name="productionID" th:field="*{productionID}" class="form-control" type="text">
                </div>
            </div>
        </div>
        <div class="col-xs-6">
            <div class="form-group">
                <label class="col-sm-4 control-label">工作情况：</label>
                <div class="col-sm-8">
                    <input name="condition" th:field="*{condition}" class="form-control" type="text">
                </div>
            </div>
        </div>
        <div class="col-xs-6">
            <div class="form-group">
                <label class="col-sm-4 control-label">设备型号：</label>
                <div class="col-sm-8">
                    <input name="deviceType" th:field="*{deviceType}" class="form-control" type="text">
                </div>
            </div>
        </div>
        <div class="col-xs-6">
            <div class="form-group">
                <label class="col-sm-4 control-label">材质：</label>
                <div class="col-sm-8">
                    <input name="texture" th:field="*{texture}" class="form-control" type="text">
                </div>
            </div>
        </div>
        <div class="col-xs-6">
            <div class="form-group">
                <label class="col-sm-4 control-label">面积：</label>
                <div class="col-sm-8">
                    <input name="area" th:field="*{area}" class="form-control" type="text">
                </div>
            </div>
        </div>
        <div class="col-xs-6">
            <div class="form-group">
                <label class="col-sm-4 control-label">数量：</label>
                <div class="col-sm-8">
                    <input name="amount" th:field="*{amount}" class="form-control" type="text">
                </div>
            </div>
        </div>
        <div class="col-xs-6">
            <div class="form-group">
                <label class="col-sm-4 control-label">修改时间：</label>
                <div class="col-sm-8">
                    <div class="input-group date">
                        <input name="modifyTime" th:value="${#dates.format(afterSales.modifyTime, 'yyyy-MM-dd')}"
                               class="form-control" placeholder="yyyy-MM-dd" type="text">
                        <span class="input-group-addon"><i class="fa fa-calendar"></i></span>
                    </div>
                </div>
            </div>
            <div class="form-group">
                <label class="form-label col-xs-4 col-sm-4">上传派工单:</label>
                <input type="file" class="form-control" onchange="gome(this)" id="front" name="front">
                <div class="formControls col-xs-5 col-sm-4">
                    <span class="fileinput-button">
				    <span>+</span>
                    </span>
                </div>

            </div>

        </div>
    </form>
</div>
<th:block th:include="include :: footer"/>
<th:block th:include="include :: datetimepicker-js"/>
<script th:inline="javascript">
    $(document).ready(function () {
        // 在这里写你的代码，它会在页面加载完成后自动执行
        console.log('edit.html 页面加载完成！');
    });
    var prefix = ctx + "system/AfterSales";
    $("#form-AfterSales-edit").validate({
        focusCleanup: true
    });

    function submitHandler() {
        if ($.validate.form()) {
            //$.operate.save(prefix + "/edit", $('#form-AfterSales-edit').serialize());
            var formData = new FormData($("#form-AfterSales-edit")[0]);

            $.ajax({
                url: prefix + "/edit",
                type: 'POST',
                data: formData,
                success: function (data) {
                    // alert(data['msg']);
                    if (data["code"] == 0){
                        alert("保存成功");
                    }
                    $.each(data, function (haha, info) {
                        console.log( "haha" + haha);
                        console.log("info" + info);
                        console.log(data["msg"] + " : " + data["code"]);

                    });

                },
                cache: false,
                contentType: false,
                processData: false
            });
        }
    }

    function handleFileSelect() {
        // 选择了一个文件
        console.log("handleFileSelect: 上传文件")

    }

    $("input[name='modifyTime']").datetimepicker({
        format: "yyyy-mm-dd",
        minView: "month",
        autoclose: true
    });

    //建立一可存取到file的url
    function getObjectURL(file) {
        var url = null;
        if (window.createObjectURL != undefined) { // basic
            url = window.createObjectURL(file);
        } else if (window.URL != undefined) { // mozilla(firefox)
            url = window.URL.createObjectURL(file);
        } else if (window.webkitURL != undefined) { // webkit or chrome
            url = window.webkitURL.createObjectURL(file);
        }
        return url;
    }

    function gome(obj) {
        console.log("gome : " + obj)
        var objUrl = getObjectURL(obj.files[0]); //获取图片的路径，该路径不是图片在本地的路径
        if (objUrl) {
            $(obj).parent().find('span').html("<img src='" + objUrl + "' width='100%'>"); //将图片路径存入src中，显示出图片
        }
    }

    // 上传图片 获取图片的宽高 文件大小
    var _URL = window.URL || window.webkitURL;
    $("#front").change(function (e) {
        var file, img;
        if ((file = this.files[0])) {
            img = new Image();
            img.onload = function () {
                alert('图片宽：' + this.width + " 图片高：" + this.height + " 图片大小：" + file.size);
            };
            img.src = _URL.createObjectURL(file);
        }
    });


</script>
</body>
</html>